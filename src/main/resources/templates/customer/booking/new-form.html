<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{customer/layout :: head}">
    <title>Book Car Wash Service</title>
    <style>
        .service-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .service-card:hover {
            transform: translateY(-2px);
            border-color: #3B82F6;
        }
        .service-card.selected {
            border-color: #3B82F6;
            background: linear-gradient(135deg, #EFF6FF, #DBEAFE);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.1);
        }
        
        .step-indicator {
            position: relative;
        }
        .step-indicator::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: #E5E7EB;
            z-index: 1;
        }
        .step-indicator .step {
            position: relative;
            z-index: 2;
            background: white;
            border: 3px solid #E5E7EB;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .step-indicator .step.active {
            border-color: #3B82F6;
            background: #3B82F6;
            color: white;
        }
        .step-indicator .step.completed {
            border-color: #10B981;
            background: #10B981;
            color: white;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .calendar-day:hover {
            background: #EFF6FF;
        }
        .calendar-day.selected {
            background: #3B82F6;
            color: white;
        }
        .calendar-day.unavailable {
            color: #D1D5DB;
            cursor: not-allowed;
        }

        .time-slot {
            padding: 12px 16px;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            text-center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .time-slot:hover {
            border-color: #3B82F6;
            background: #EFF6FF;
        }
        .time-slot.selected {
            border-color: #3B82F6;
            background: #3B82F6;
            color: white;
        }
        .time-slot.unavailable {
            background: #F3F4F6;
            color: #9CA3AF;
            cursor: not-allowed;
        }

        .step-content {
            display: none;
        }
        .step-content.active {
            display: block;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div th:replace="~{customer/layout :: layout('Book Service', ~{::section})}">
        <section>
            <div class="p-6 max-w-6xl mx-auto">
                <!-- Progress Indicator -->
                <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
                    <div class="flex items-center justify-between mb-4 step-indicator">
                        <div class="step active" data-step="1">1</div>
                        <div class="step" data-step="2">2</div>
                        <div class="step" data-step="3">3</div>
                        <div class="step" data-step="4">4</div>
                    </div>
                    <div class="text-center">
                        <h2 class="text-xl font-semibold text-gray-800" id="step-title">Choose Your Service</h2>
                        <p class="text-gray-600 text-sm" id="step-subtitle">Select the perfect car wash package for your vehicle</p>
                    </div>
                </div>

                <!-- Step 1: Select Service -->
                <div id="step-1" class="step-content active fade-in">
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <!-- Quick Wash -->
                            <div class="service-card border-2 border-gray-200 rounded-xl p-6" 
                                 data-service="quick-wash" data-price="50000" data-duration="30">
                                <div class="text-center mb-6">
                                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <i class="fas fa-spray-can text-blue-600 text-2xl"></i>
                                    </div>
                                    <h3 class="text-xl font-bold text-gray-800 mb-2">Quick Wash</h3>
                                    <p class="text-gray-600 text-sm">Perfect for regular maintenance</p>
                                </div>
                                
                                <div class="space-y-3 mb-6">
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-check text-green-500 mr-3 w-4"></i>
                                        <span>Exterior hand wash</span>
                                    </div>
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-check text-green-500 mr-3 w-4"></i>
                                        <span>Wheel cleaning</span>
                                    </div>
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-check text-green-500 mr-3 w-4"></i>
                                        <span>Hand drying</span>
                                    </div>
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-check text-green-500 mr-3 w-4"></i>
                                        <span>Basic tire shine</span>
                                    </div>
                                </div>
                                
                                <div class="text-center border-t pt-4">
                                    <div class="text-2xl font-bold text-blue-600 mb-1">Rp 50,000</div>
                                    <div class="text-gray-500 text-sm flex items-center justify-center">
                                        <i class="fas fa-clock mr-1"></i>
                                        ~30 minutes
                                    </div>
                                </div>
                            </div>

                            <!-- Premium Wash -->
                            <div class="service-card border-2 border-gray-200 rounded-xl p-6 relative" 
                                 data-service="premium-wash" data-price="75000" data-duration="60">
                                <div class="absolute top-3 right-3">
                                    <span class="bg-purple-100 text-purple-600 text-xs font-semibold px-2 py-1 rounded-full">
                                        Popular
                                    </span>
                                </div>
                                <div class="text-center mb-6">
                                    <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <i class="fas fa-gem text-purple-600 text-2xl"></i>
                                    </div>
                                    <h3 class="text-xl font-bold text-gray-800 mb-2">Premium Wash</h3>
                                    <p class="text-gray-600 text-sm">Complete interior & exterior care</p>
                                </div>
                                
                                <div class="space-y-3 mb-6">
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-check text-green-500 mr-3 w-4"></i>
                                        <span>Everything in Quick Wash</span>
                                    </div>
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-check text-green-500 mr-3 w-4"></i>
                                        <span>Interior vacuuming</span>
                                    </div>
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-check text-green-500 mr-3 w-4"></i>
                                        <span>Dashboard cleaning</span>
                                    </div>
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-check text-green-500 mr-3 w-4"></i>
                                        <span>Glass cleaning</span>
                                    </div>
                                </div>
                                
                                <div class="text-center border-t pt-4">
                                    <div class="text-2xl font-bold text-purple-600 mb-1">Rp 75,000</div>
                                    <div class="text-gray-500 text-sm flex items-center justify-center">
                                        <i class="fas fa-clock mr-1"></i>
                                        ~60 minutes
                                    </div>
                                </div>
                            </div>

                            <!-- Deep Clean -->
                            <div class="service-card border-2 border-gray-200 rounded-xl p-6" 
                                 data-service="deep-clean" data-price="100000" data-duration="90">
                                <div class="text-center mb-6">
                                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <i class="fas fa-award text-green-600 text-2xl"></i>
                                    </div>
                                    <h3 class="text-xl font-bold text-gray-800 mb-2">Deep Clean</h3>
                                    <p class="text-gray-600 text-sm">Ultimate detailing experience</p>
                                </div>
                                
                                <div class="space-y-3 mb-6">
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-check text-green-500 mr-3 w-4"></i>
                                        <span>Everything in Premium</span>
                                    </div>
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-check text-green-500 mr-3 w-4"></i>
                                        <span>Engine bay cleaning</span>
                                    </div>
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-check text-green-500 mr-3 w-4"></i>
                                        <span>Leather conditioning</span>
                                    </div>
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-check text-green-500 mr-3 w-4"></i>
                                        <span>Premium wax coating</span>
                                    </div>
                                </div>
                                
                                <div class="text-center border-t pt-4">
                                    <div class="text-2xl font-bold text-green-600 mb-1">Rp 100,000</div>
                                    <div class="text-gray-500 text-sm flex items-center justify-center">
                                        <i class="fas fa-clock mr-1"></i>
                                        ~90 minutes
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Select Date & Time -->
                <div id="step-2" class="step-content">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Calendar -->
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Select Date</h3>
                            <div class="calendar">
                                <!-- Calendar Header -->
                                <div class="flex justify-between items-center mb-4">
                                    <button id="prev-month" class="p-2 hover:bg-gray-100 rounded-lg">
                                        <i class="fas fa-chevron-left text-gray-600"></i>
                                    </button>
                                    <h4 class="text-lg font-semibold text-gray-800" id="current-month">June 2025</h4>
                                    <button id="next-month" class="p-2 hover:bg-gray-100 rounded-lg">
                                        <i class="fas fa-chevron-right text-gray-600"></i>
                                    </button>
                                </div>
                                
                                <!-- Calendar Grid -->
                                <div class="grid grid-cols-7 gap-1 mb-2">
                                    <div class="text-center text-sm font-medium text-gray-500 p-2">Sun</div>
                                    <div class="text-center text-sm font-medium text-gray-500 p-2">Mon</div>
                                    <div class="text-center text-sm font-medium text-gray-500 p-2">Tue</div>
                                    <div class="text-center text-sm font-medium text-gray-500 p-2">Wed</div>
                                    <div class="text-center text-sm font-medium text-gray-500 p-2">Thu</div>
                                    <div class="text-center text-sm font-medium text-gray-500 p-2">Fri</div>
                                    <div class="text-center text-sm font-medium text-gray-500 p-2">Sat</div>
                                </div>
                                
                                <div class="grid grid-cols-7 gap-1" id="calendar-grid">
                                    <!-- Calendar days will be generated by JavaScript -->
                                </div>
                            </div>
                        </div>

                        <!-- Time Slots -->
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Available Time Slots</h3>
                            <div id="time-slots-container">
                                <div class="text-center text-gray-500 py-8">
                                    <i class="fas fa-calendar-day text-3xl mb-3"></i>
                                    <p>Please select a date first</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Vehicle Information -->
                <div id="step-3" class="step-content">
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-6">Vehicle Information</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Vehicle Type</label>
                                <select class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option>Select vehicle type</option>
                                    <option value="sedan">Sedan</option>
                                    <option value="suv">SUV</option>
                                    <option value="hatchback">Hatchback</option>
                                    <option value="truck">Truck</option>
                                    <option value="motorcycle">Motorcycle</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">License Plate</label>
                                <input type="text" placeholder="B 1234 ABC" 
                                       class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Vehicle Brand</label>
                                <input type="text" placeholder="Toyota, Honda, etc." 
                                       class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Vehicle Model</label>
                                <input type="text" placeholder="Avanza, Civic, etc." 
                                       class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Special Instructions (Optional)</label>
                                <textarea rows="3" placeholder="Any special requests or notes for our team..." 
                                          class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Confirmation -->
                <div id="step-4" class="step-content">
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-6">Booking Summary</h3>
                        <div id="booking-summary">
                            <!-- Booking details will be populated by JavaScript -->
                        </div>
                        
                        <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                            <div class="flex items-start">
                                <i class="fas fa-info-circle text-blue-600 mr-3 mt-0.5"></i>
                                <div class="text-sm text-blue-800">
                                    <p class="font-medium mb-1">Booking Policy:</p>
                                    <ul class="space-y-1 text-xs">
                                        <li>• Free cancellation up to 2 hours before appointment</li>
                                        <li>• Please arrive 10 minutes before your scheduled time</li>
                                        <li>• Payment can be made on-site or through digital wallet</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="flex justify-between mt-8">
                    <button id="prev-btn" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors" style="display: none;">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Previous
                    </button>
                    
                    <div class="flex space-x-4 ml-auto">
                        <button id="next-btn" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors" disabled>
                            Next
                            <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                        
                        <button id="book-btn" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors" style="display: none;">
                            <i class="fas fa-check mr-2"></i>
                            Confirm Booking
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Booking form JavaScript
        let currentStep = 1;
        let selectedService = null;
        let selectedDate = null;
        let selectedTime = null;
        let bookingData = {};

        // Initialize the form
        document.addEventListener('DOMContentLoaded', function() {
            initializeServiceSelection();
            initializeCalendar();
            updateStepDisplay();
        });

        function initializeServiceSelection() {
            const serviceCards = document.querySelectorAll('.service-card');
            serviceCards.forEach(card => {
                card.addEventListener('click', function() {
                    // Remove previous selection
                    serviceCards.forEach(c => c.classList.remove('selected'));
                    
                    // Add selection to clicked card
                    this.classList.add('selected');
                    
                    // Store selection
                    selectedService = {
                        name: this.querySelector('h3').textContent,
                        price: this.dataset.price,
                        duration: this.dataset.duration,
                        service: this.dataset.service
                    };
                    
                    // Enable next button
                    document.getElementById('next-btn').disabled = false;
                });
            });
        }

        function initializeCalendar() {
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            generateCalendar(currentYear, currentMonth);
            
            document.getElementById('prev-month').addEventListener('click', function() {
                const current = new Date(currentYear, currentMonth - 1);
                generateCalendar(current.getFullYear(), current.getMonth());
            });
            
            document.getElementById('next-month').addEventListener('click', function() {
                const current = new Date(currentYear, currentMonth + 1);
                generateCalendar(current.getFullYear(), current.getMonth());
            });
        }

        function generateCalendar(year, month) {
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"];
            
            document.getElementById('current-month').textContent = `${monthNames[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            
            const calendarGrid = document.getElementById('calendar-grid');
            calendarGrid.innerHTML = '';
            
            // Add empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                calendarGrid.appendChild(emptyDay);
            }
            
            // Add days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                const currentDate = new Date(year, month, day);
                
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                // Disable past dates
                if (currentDate < today.setHours(0,0,0,0)) {
                    dayElement.classList.add('unavailable');
                } else {
                    dayElement.addEventListener('click', function() {
                        // Remove previous selection
                        document.querySelectorAll('.calendar-day.selected').forEach(d => 
                            d.classList.remove('selected'));
                        
                        // Add selection
                        this.classList.add('selected');
                        selectedDate = new Date(year, month, day);
                        
                        // Generate time slots
                        generateTimeSlots();
                    });
                }
                
                calendarGrid.appendChild(dayElement);
            }
        }

        function generateTimeSlots() {
            const container = document.getElementById('time-slots-container');
            const timeSlots = [
                '08:00', '08:30', '09:00', '09:30', '10:00', '10:30',
                '11:00', '11:30', '13:00', '13:30', '14:00', '14:30',
                '15:00', '15:30', '16:00', '16:30', '17:00', '17:30'
            ];
            
            container.innerHTML = '<div class="grid grid-cols-3 gap-3"></div>';
            const grid = container.querySelector('.grid');
            
            timeSlots.forEach(time => {
                const timeSlot = document.createElement('div');
                timeSlot.className = 'time-slot';
                timeSlot.textContent = time;
                
                // Randomly make some slots unavailable for demo
                if (Math.random() > 0.7) {
                    timeSlot.classList.add('unavailable');
                    timeSlot.innerHTML += '<br><small>Booked</small>';
                } else {
                    timeSlot.addEventListener('click', function() {
                        document.querySelectorAll('.time-slot.selected').forEach(t => 
                            t.classList.remove('selected'));
                        this.classList.add('selected');
                        selectedTime = time;
                        
                        // Enable next button if both date and time are selected
                        if (selectedDate && selectedTime) {
                            document.getElementById('next-btn').disabled = false;
                        }
                    });
                }
                
                grid.appendChild(timeSlot);
            });
        }

        function updateStepDisplay() {
            // Update step indicators
            document.querySelectorAll('.step').forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index + 1 < currentStep) {
                    step.classList.add('completed');
                } else if (index + 1 === currentStep) {
                    step.classList.add('active');
                }
            });
            
            // Update step content
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`step-${currentStep}`).classList.add('active', 'fade-in');
            
            // Update title and subtitle
            const titles = {
                1: { title: 'Choose Your Service', subtitle: 'Select the perfect car wash package for your vehicle' },
                2: { title: 'Select Date & Time', subtitle: 'Pick your preferred appointment schedule' },
                3: { title: 'Vehicle Information', subtitle: 'Tell us about your vehicle' },
                4: { title: 'Confirm Booking', subtitle: 'Review your booking details' }
            };
            
            document.getElementById('step-title').textContent = titles[currentStep].title;
            document.getElementById('step-subtitle').textContent = titles[currentStep].subtitle;
            
            // Update navigation buttons
            document.getElementById('prev-btn').style.display = currentStep > 1 ? 'block' : 'none';
            document.getElementById('next-btn').style.display = currentStep < 4 ? 'block' : 'none';
            document.getElementById('book-btn').style.display = currentStep === 4 ? 'block' : 'none';
            
            // Generate booking summary on step 4
            if (currentStep === 4) {
                generateBookingSummary();
            }
        }

        function generateBookingSummary() {
            const summary = document.getElementById('booking-summary');
            const dateStr = selectedDate.toLocaleDateString('id-ID', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            summary.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-3">Service Details</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Service:</span>
                                <span class="font-medium">${selectedService?.name || 'Not selected'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Duration:</span>
                                <span class="font-medium">${selectedService?.duration || 0} minutes</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Price:</span>
                                <span class="font-medium">Rp ${parseInt(selectedService?.price || 0).toLocaleString('id-ID')}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-3">Appointment</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Date:</span>
                                <span class="font-medium">${dateStr}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Time:</span>
                                <span class="font-medium">${selectedTime || 'Not selected'}</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 pt-6 border-t">
                    <div class="flex justify-between items-center">
                        <span class="text-lg font-semibold text-gray-800">Total Amount:</span>
                        <span class="text-2xl font-bold text-blue-600">Rp ${parseInt(selectedService?.price || 0).toLocaleString('id-ID')}</span>
                    </div>
                </div>
            `;
        }

        // Navigation event listeners
        document.getElementById('next-btn').addEventListener('click', function() {
            if (currentStep < 4) {
                currentStep++;
                updateStepDisplay();
                document.getElementById('next-btn').disabled = true;
                
                // Auto-enable next button for steps that don't require selection
                if (currentStep === 3) {
                    setTimeout(() => {
                        document.getElementById('next-btn').disabled = false;
                    }, 500);
                }
            }
        });

        document.getElementById('prev-btn').addEventListener('click', function() {
            if (currentStep > 1) {
                currentStep--;
                updateStepDisplay();
                document.getElementById('next-btn').disabled = false;
            }
        });

        document.getElementById('book-btn').addEventListener('click', function() {
            // Here you would normally submit the booking data
            alert('Booking confirmed! You will receive a confirmation email shortly.');
            window.location.href = '/customer/bookings';
        });
    </script>

    <div th:replace="~{customer/layout :: scripts}"></div>
</body>
</html>
