<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Konfirmasi Pembayaran - CarWash</title>
</head>
<body>
<div th:replace="~{employee/layout :: layout(~{::title}, ~{::content})}">
    <title>Konfirmasi Pembayaran - CarWash</title>
    
    <div th:fragment="content">        <style>
            /* Card Styles */
            .payment-card {
                border-radius: 16px;
                transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
                border: 1px solid #e5e7eb;
                background-color: white;
                box-shadow: 0 4px 15px rgba(0,0,0,0.04);
                position: relative;
                overflow: hidden;
            }
            
            .payment-card:hover {
                transform: translateY(-4px);
                box-shadow: 0 16px 32px rgba(0,0,0,0.12);
                border-color: #d1d5db;
            }
            
            .payment-card:after {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                border-radius: 16px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
                opacity: 0;
                transition: all 0.3s ease;
                z-index: -1;
            }
            
            .payment-card:hover:after {
                opacity: 1;
            }
            
            /* Status Badges */
            .status-badge {
                padding: 0.35rem 1rem;
                border-radius: 30px;
                font-size: 0.8rem;
                font-weight: 600;
                display: inline-flex;
                align-items: center;
                gap: 5px;
                letter-spacing: 0.02em;
                box-shadow: 0 2px 5px rgba(0,0,0,0.08);
                transition: all 0.3s ease;
                position: relative;
            }
            
            .status-badge i {
                font-size: 0.8rem;
            }
            
            .status-pending { 
                background: linear-gradient(45deg, #ffedd5, #fff7ed); 
                color: #ea580c; 
                border: 1px solid rgba(234, 88, 12, 0.3);
            }
            
            .status-pending:hover {
                transform: translateY(-1px);
                box-shadow: 0 4px 8px rgba(234, 88, 12, 0.2);
            }
            
            .status-confirmed { 
                background: linear-gradient(45deg, #dbeafe, #eff6ff); 
                color: #2563eb; 
                border: 1px solid rgba(37, 99, 235, 0.3);
            }
            
            .status-confirmed:hover {
                transform: translateY(-1px);
                box-shadow: 0 4px 8px rgba(37, 99, 235, 0.2);
            }
            
            /* Price Display */
            .amount-display {
                font-size: 1.2rem;
                font-weight: 700;
                color: #059669;
                background: linear-gradient(45deg, #d1fae5, #ecfdf5);
                padding: 0.4rem 1rem;
                border-radius: 12px;
                border: 1px solid rgba(5, 150, 105, 0.2);
                box-shadow: 0 2px 6px rgba(5, 150, 105, 0.1);
                transition: all 0.3s ease;
            }
            
            .amount-display:hover {
                transform: translateY(-1px);
                box-shadow: 0 4px 10px rgba(5, 150, 105, 0.15);
            }
            
            /* Transaction Info Box */
            .transaction-info {
                background-color: #f8fafc;
                border-radius: 12px;
                padding: 1.2rem;
                border: 1px solid #e2e8f0;
                transition: all 0.3s ease;
            }
            
            .transaction-info:hover {
                background-color: #f1f5f9;
                box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            }
            
            /* Table Styles */
            .table-payment {
                border-collapse: separate;
                border-spacing: 0;
                width: 100%;
            }
            
            .table-payment th {
                background: linear-gradient(180deg, #f8fafc, #f1f5f9);
                border-bottom: 2px solid #e5e7eb;
                font-weight: 600;
                color: #334155;
                padding: 1.2rem 1rem;
                position: relative;
            }
            
            .table-payment td {
                padding: 1.2rem 1rem;
                border-bottom: 1px solid #f1f5f9;
                vertical-align: middle;
            }
            
            .table-payment tbody tr {
                transition: all 0.3s ease;
            }
            
            .table-payment tbody tr:hover {
                background-color: #f8fafc;
                transform: scale(1.01);
                box-shadow: 0 4px 12px rgba(0,0,0,0.05);
                z-index: 1;
                position: relative;
            }
            
            /* Empty State */
            .empty-state {
                text-align: center;
                padding: 3rem 0;
            }
            
            .empty-state-icon {
                width: 80px;
                height: 80px;
                background: #ecfdf5;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0 auto 1.5rem;
                color: #059669;
                font-size: 2rem;
            }
            
            /* Summary Cards */
            .summary-card {
                border-radius: 16px;
                padding: 1.5rem;
                background: white;
                border: 1px solid #e5e7eb;
                box-shadow: 0 4px 15px rgba(0,0,0,0.05);
                transition: all 0.3s ease;
            }
            
            .summary-card:hover {
                box-shadow: 0 10px 25px rgba(0,0,0,0.1);
                transform: translateY(-2px);
            }
            
            .summary-icon {
                width: 50px;
                height: 50px;
                border-radius: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.5rem;
            }
            
            .summary-icon-pending {
                background-color: #fff7ed;
                color: #ea580c;
            }
              /* Button Styles */
            .btn-action {
                border-radius: 10px;
                font-weight: 600;
                padding: 0.5rem 1rem;
                transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                position: relative;
                overflow: hidden;
                box-shadow: 0 2px 5px rgba(0,0,0,0.05);
                z-index: 1;
            }
            
            .btn-action:before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(255,255,255,0.1);
                z-index: -1;
                transform: scale(0);
                transition: all 0.3s ease;
                border-radius: 50%;
                opacity: 0;
            }
            
            .btn-action:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 15px rgba(0,0,0,0.1);
            }
            
            .btn-action:hover:before {
                transform: scale(2);
                opacity: 1;
            }
            
            .btn-action:active {
                transform: translateY(1px);
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            }
            
            .btn-confirm {
                background: linear-gradient(45deg, #10b981, #059669);
                border: none;
                color: white;
            }
            
            .btn-confirm:hover {
                background: linear-gradient(45deg, #059669, #047857);
            }
            
            .btn-detail {
                background: linear-gradient(45deg, #f9fafb, #f3f4f6);
                border: 1px solid #e5e7eb;
                color: #4b5563;
            }
            
            .btn-detail:hover {
                background: linear-gradient(45deg, #f3f4f6, #e5e7eb);
                border-color: #d1d5db;
                color: #111827;
            }
            
            /* Icon Animations */
            .btn-action i {
                transition: all 0.3s ease;
            }
            
            .btn-action:hover i {
                transform: scale(1.2);
            }
            
            /* Row Animations */
            .payment-row {
                position: relative;
                z-index: 1;
                transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
            }
            
            .payment-row::after {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(255, 255, 255, 0.05);
                opacity: 0;
                transform: scale(0.9);
                transition: all 0.3s ease;
                z-index: -1;
            }
            
            .payment-row:hover {
                transform: translateY(-2px) scale(1.01);
                z-index: 10;
            }
            
            .payment-row:hover::after {
                opacity: 1;
                transform: scale(1);
            }
            
            .payment-row.row-confirm-success {
                animation: confirm-success 1.5s forwards;
            }
            
            .payment-row.row-reject {
                animation: reject-row 1.5s forwards;
            }
            
            @keyframes confirm-success {
                0% { background-color: transparent; transform: translateY(0); }
                10% { background-color: #d1fae5; }
                90% { background-color: #d1fae5; opacity: 1; transform: translateY(-5px); }
                100% { background-color: #d1fae5; opacity: 0; transform: translateY(-10px); }
            }
            
            @keyframes reject-row {
                0% { background-color: transparent; transform: translateX(0); }
                10% { background-color: #fee2e2; }
                20% { transform: translateX(5px); }
                40% { transform: translateX(-5px); }
                60% { transform: translateX(3px); }
                80% { transform: translateX(-3px); background-color: #fee2e2; opacity: 1; }
                100% { transform: translateX(0); background-color: #fee2e2; opacity: 0; }
            }
        </style>        <!-- Header with Breadcrumb -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="ps-2">
                        <nav aria-label="breadcrumb" class="mb-3">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="/employee" class="text-decoration-none"><i class="fas fa-home"></i> Dashboard</a></li>
                                <li class="breadcrumb-item active" aria-current="page">Konfirmasi Pembayaran</li>
                            </ol>
                        </nav>
                        <h2 class="fw-bold text-dark mb-3">Konfirmasi Pembayaran</h2>
                        <p class="text-muted">Kelola dan konfirmasi pembayaran dari customer</p>
                    </div>
                </div>
            </div>
        </div><!-- Status Summary -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="summary-card" th:classappend="${pendingPaymentBookings.size() > 0 ? 'has-pending' : ''}">
                    <div class="d-flex align-items-center">
                        <div class="summary-icon summary-icon-pending me-3">
                            <div class="icon-pulse"></div>
                            <i class="fas fa-clock"></i>
                        </div>
                        <div>
                            <h5 class="fw-bold mb-1" th:text="${pendingPaymentBookings.size()}">0</h5>
                            <p class="text-muted mb-0">Pembayaran Menunggu Konfirmasi</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <div class="alert alert-info d-flex align-items-center border-start border-info border-4" style="background-color: #eff6ff; border-color: #3b82f6 !important">
                    <div class="p-2 me-3 bg-info bg-opacity-10 rounded-circle text-info">
                        <i class="fas fa-info-circle fs-4"></i>
                    </div>
                    <div>
                        <strong class="d-block mb-1">Informasi!</strong>
                        <span>Konfirmasi pembayaran segera untuk memastikan booking customer dapat diproses dengan cepat.</span>
                    </div>
                </div>
            </div>
        </div>
        
        <style>
            /* Pulse Animation for Summary Icon */
            .summary-icon {
                position: relative;
                width: 50px;
                height: 50px;
                border-radius: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.5rem;
            }
            
            .summary-icon-pending {
                background-color: #fff7ed;
                color: #ea580c;
            }
            
            .has-pending .summary-icon-pending {
                animation: card-attention 2s infinite;
            }
            
            .icon-pulse {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                border-radius: 12px;
                background-color: rgba(234, 88, 12, 0.4);
                opacity: 0;
            }
            
            .has-pending .icon-pulse {
                animation: icon-pulse 2s infinite;
            }
            
            @keyframes icon-pulse {
                0% { opacity: 0.8; transform: scale(1); }
                70% { opacity: 0; transform: scale(1.5); }
                100% { opacity: 0; transform: scale(1.5); }
            }
            
            @keyframes card-attention {
                0%, 100% { transform: translateY(0); }
                10% { transform: translateY(-2px); }
                20% { transform: translateY(0); }
                30% { transform: translateY(-2px); }
                40% { transform: translateY(0); }
            }
        </style><!-- Pending Payments List -->
        <div class="row" th:if="${pendingPaymentBookings != null and !pendingPaymentBookings.isEmpty()}">
            <div class="col-12">
                <div class="card border-0 shadow-sm">                    <div class="card-header d-flex justify-content-between align-items-center bg-white py-3 border-bottom border-2">
                        <div>
                            <h5 class="fw-bold mb-0">
                                <i class="fas fa-list-alt me-2 text-primary"></i>
                                Daftar Pembayaran Menunggu Konfirmasi
                            </h5>
                            <p class="text-muted mt-1 mb-0 small">
                                <i class="fas fa-info-circle me-1"></i>
                                Klik tombol "Detail" untuk melihat informasi lengkap atau "Konfirmasi" untuk menyetujui pembayaran
                            </p>
                        </div>
                        <div class="d-flex align-items-center gap-2">
                            <span class="badge bg-warning text-dark rounded-pill px-3 py-2" 
                                  th:text="${pendingPaymentBookings.size()} + ' pembayaran'">
                                  0 pembayaran
                            </span>
                            <button class="btn btn-sm btn-outline-secondary ms-2" onclick="window.location.reload()" title="Refresh daftar">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0">                        <div class="table-responsive">
                            <table class="table table-hover table-payment mb-0">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Customer</th>
                                        <th>Layanan</th>
                                        <th>Kendaraan</th>
                                        <th>Tanggal & Jam</th>
                                        <th>Total</th>
                                        <th class="text-end">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="booking : ${pendingPaymentBookings}" th:id="'booking-' + ${booking.idBooking}" class="payment-row">
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <span class="badge rounded-pill bg-light text-dark border px-3 py-2 me-2">#<span th:text="${booking.idBooking}"></span></span>
                                                <span class="status-badge status-pending d-none d-md-inline-flex">
                                                    <i class="fas fa-clock"></i> Pending
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="bg-primary bg-opacity-10 rounded-circle p-2 me-2 d-none d-lg-flex">
                                                    <i class="fas fa-user text-primary"></i>
                                                </div>
                                                <div>
                                                    <div class="fw-semibold" th:text="${booking.user.fullName}"></div>
                                                    <small class="text-muted"><i class="fas fa-phone-alt me-1"></i><span th:text="${booking.user.phoneNumber}"></span></small>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="badge bg-primary bg-opacity-10 text-primary border border-primary border-opacity-25 px-3 py-2" th:text="${booking.service.serviceName}"></span>
                                        </td>
                                        <td>
                                            <div class="fw-semibold" th:text="${booking.vehicleBrand + ' ' + booking.vehicleModel}"></div>
                                            <div class="d-flex align-items-center mt-1">
                                                <span class="badge bg-dark bg-opacity-10 text-dark border px-2 py-1">
                                                    <i class="fas fa-car me-1"></i><span th:text="${booking.vehiclePlate}"></span>
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="transaction-info p-2">
                                                <div class="fw-semibold">
                                                    <i class="fas fa-calendar-alt me-2 text-primary"></i>
                                                    <span th:text="${#temporals.format(booking.tanggal, 'dd MMM yyyy')}"></span>
                                                </div>
                                                <small class="text-muted">
                                                    <i class="fas fa-clock me-1"></i>
                                                    <span th:text="${#temporals.format(booking.jam, 'HH:mm')}"></span> WIB
                                                </small>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="amount-display" th:text="'Rp ' + ${#numbers.formatInteger(booking.service.price, 0, 'COMMA')}"></span>
                                        </td>
                                        <td class="text-end">
                                            <div class="btn-group">
                                                <a th:href="@{/employee/payments/details/{id}(id=${booking.idBooking})}" 
                                                   class="btn btn-action btn-detail me-2">
                                                    <i class="fas fa-eye me-1"></i> Detail
                                                </a>
                                                <button type="button" 
                                                        class="btn btn-action btn-confirm" 
                                                        th:data-booking-id="${booking.idBooking}"
                                                        onclick="confirmPayment(this.getAttribute('data-booking-id'))">
                                                    <i class="fas fa-check-circle me-1"></i> Konfirmasi
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>        <!-- Empty State -->
        <div class="row mt-4" th:if="${pendingPaymentBookings == null or pendingPaymentBookings.isEmpty()}">
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-body empty-state p-5">
                        <div class="empty-state-animation mb-5">
                            <div class="success-checkmark">
                                <div class="check-icon">
                                    <span class="icon-line line-tip"></span>
                                    <span class="icon-line line-long"></span>
                                    <div class="icon-circle"></div>
                                    <div class="icon-fix"></div>
                                </div>
                            </div>
                        </div>
                        <h3 class="fw-bold mb-3">Tidak Ada Pembayaran Tertunda</h3>
                        <p class="text-muted mb-5">Semua pembayaran telah dikonfirmasi dan siap untuk diproses</p>
                        <div class="d-flex flex-wrap justify-content-center gap-3">
                            <a href="/employee/work-queue" class="btn btn-primary rounded-pill px-5 py-2">
                                <i class="fas fa-tasks me-2"></i> Lihat Antrian Pekerjaan
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <style>
            /* Success Checkmark Animation */
            .success-checkmark {
                width: 80px;
                height: 80px;
                margin: 0 auto;
                padding: 15px;
                border-radius: 50%;
                box-sizing: content-box;
                border: 4px solid #4caf50;
            }
            
            .success-checkmark .check-icon {
                width: 80px;
                height: 80px;
                position: relative;
                border-radius: 50%;
                box-sizing: content-box;
                background-color: #fff;
            }
            
            .success-checkmark .check-icon::before {
                top: 3px;
                left: -2px;
                width: 30px;
                transform-origin: 100% 50%;
                border-radius: 100px 0 0 100px;
            }
            
            .success-checkmark .check-icon::after {
                top: 0;
                left: 30px;
                width: 60px;
                transform-origin: 0 50%;
                border-radius: 0 100px 100px 0;
                animation: rotate-circle 4.25s ease-in infinite;
            }
            
            .success-checkmark .check-icon::before, .success-checkmark .check-icon::after {
                content: '';
                height: 100px;
                position: absolute;
                background: #fff;
                transform: rotate(-45deg);
            }
            
            .success-checkmark .check-icon .icon-line {
                height: 5px;
                background-color: #4caf50;
                display: block;
                border-radius: 2px;
                position: absolute;
                z-index: 10;
            }
            
            .success-checkmark .check-icon .icon-line.line-tip {
                top: 46px;
                left: 14px;
                width: 25px;
                transform: rotate(45deg);
                animation: icon-line-tip 0.75s;
            }
            
            .success-checkmark .check-icon .icon-line.line-long {
                top: 38px;
                right: 8px;
                width: 47px;
                transform: rotate(-45deg);
                animation: icon-line-long 0.75s;
            }
            
            .success-checkmark .check-icon .icon-circle {
                top: -4px;
                left: -4px;
                z-index: 10;
                width: 80px;
                height: 80px;
                border-radius: 50%;
                position: absolute;
                box-sizing: content-box;
                border: 4px solid rgba(76, 175, 80, 0.5);
            }
            
            .success-checkmark .check-icon .icon-fix {
                top: 8px;
                width: 5px;
                left: 26px;
                z-index: 1;
                height: 85px;
                position: absolute;
                transform: rotate(-45deg);
                background-color: #fff;
            }
            
            @keyframes rotate-circle {
                0% { transform: rotate(-45deg); }
                5% { transform: rotate(-45deg); }
                12% { transform: rotate(-405deg); }
                100% { transform: rotate(-405deg); }
            }
            
            @keyframes icon-line-tip {
                0% { width: 0; left: 1px; top: 19px; }
                54% { width: 0; left: 1px; top: 19px; }
                70% { width: 50px; left: -8px; top: 37px; }
                84% { width: 17px; left: 21px; top: 48px; }
                100% { width: 25px; left: 14px; top: 45px; }
            }
            
            @keyframes icon-line-long {
                0% { width: 0; right: 46px; top: 54px; }
                65% { width: 0; right: 46px; top: 54px; }
                84% { width: 55px; right: 0px; top: 35px; }
                100% { width: 47px; right: 8px; top: 38px; }
            }
        </style>

        <!-- JavaScript -->
        <script>
            // Booking ID global variable
            let currentBookingId = null;
              function confirmPayment(bookingId) {
                currentBookingId = bookingId;
                
                // Set booking details in modal
                const bookingRow = document.getElementById('booking-' + bookingId);
                if (bookingRow) {
                    // Get customer name
                    const customerName = bookingRow.querySelector('td:nth-child(2) div.fw-semibold').innerText;
                    document.getElementById('confirmTitle').innerText = 'Konfirmasi Pembayaran: ' + customerName;
                    
                    // Set booking ID
                    document.getElementById('confirmBookingId').innerText = '#' + bookingId;
                    
                    // Get amount
                    const amount = bookingRow.querySelector('.amount-display').innerText;
                    document.getElementById('confirmAmount').innerText = amount;
                    
                    // Reset any previous notes
                    document.getElementById('confirmNotes').value = '';
                    
                    // Add service info for better context
                    const serviceName = bookingRow.querySelector('td:nth-child(3) span').innerText;
                    const vehicleInfo = bookingRow.querySelector('td:nth-child(4) div.fw-semibold').innerText;
                    
                    // Create additional info if not exists
                    if (!document.getElementById('confirmServiceInfo')) {
                        const serviceInfo = document.createElement('div');
                        serviceInfo.id = 'confirmServiceInfo';
                        serviceInfo.className = 'd-flex justify-content-between align-items-center mb-2';
                        serviceInfo.innerHTML = `
                            <span class="text-muted">Layanan:</span>
                            <span class="badge bg-primary bg-opacity-10 text-primary">${serviceName}</span>
                        `;
                        
                        const vehicleInfoEl = document.createElement('div');
                        vehicleInfoEl.id = 'confirmVehicleInfo';
                        vehicleInfoEl.className = 'd-flex justify-content-between align-items-center';
                        vehicleInfoEl.innerHTML = `
                            <span class="text-muted">Kendaraan:</span>
                            <span class="fw-bold">${vehicleInfo}</span>
                        `;
                        
                        const infoContainer = document.querySelector('.booking-info');
                        infoContainer.insertBefore(serviceInfo, infoContainer.lastElementChild);
                        infoContainer.insertBefore(vehicleInfoEl, infoContainer.lastElementChild);
                    } else {
                        document.querySelector('#confirmServiceInfo .badge').innerText = serviceName;
                        document.querySelector('#confirmVehicleInfo span:last-child').innerText = vehicleInfo;
                    }
                }
                
                // Show modal with animation
                const modalElement = document.getElementById('confirmModal');
                modalElement.classList.add('fade');
                
                const modal = new bootstrap.Modal(modalElement);
                modal.show();
                
                // Add event listener to submit button (only once)
                const submitButton = document.getElementById('confirmSubmit');
                submitButton.onclick = processConfirmPayment;
            }
            
            function processConfirmPayment() {
                if (!currentBookingId) return;
                  // Show loading state with animated button
                const submitButton = document.getElementById('confirmSubmit');
                const originalButtonText = submitButton.innerHTML;
                submitButton.disabled = true;
                submitButton.classList.add('processing');
                submitButton.innerHTML = `
                    <div class="spinner-container">
                        <div class="spinner-border spinner-border-sm text-light me-2" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <span>Memproses...</span>
                    </div>`;
                
                // Add loading styles
                document.head.insertAdjacentHTML('beforeend', `
                    <style>
                        .processing {
                            position: relative;
                            overflow: hidden;
                        }
                        
                        .processing:before {
                            content: '';
                            position: absolute;
                            top: 0;
                            left: 0;
                            height: 100%;
                            width: 100%;
                            background: linear-gradient(
                                90deg, 
                                rgba(255,255,255,0) 0%, 
                                rgba(255,255,255,0.2) 50%, 
                                rgba(255,255,255,0) 100%);
                            animation: shimmer 1.5s infinite;
                        }
                        
                        @keyframes shimmer {
                            0% { transform: translateX(-100%); }
                            100% { transform: translateX(100%); }
                        }
                        
                        .spinner-container {
                            display: flex;
                            align-items: center;
                            justify-content: center;
                        }
                    </style>
                `);
                
                const bookingRow = document.getElementById('booking-' + currentBookingId);
                if (bookingRow) {
                    bookingRow.classList.add('table-active');
                }
                
                // Get notes
                const notes = document.getElementById('confirmNotes').value || 'Payment confirmed by cashier';
                
                // Make AJAX request
                fetch(`/employee/api/confirm-payment/${currentBookingId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ notes })
                })
                .then(response => response.json())
                .then(data => {
                    // Hide modal
                    bootstrap.Modal.getInstance(document.getElementById('confirmModal')).hide();
                    
                    if (data.success) {
                        // Show success message with animation
                        showAlert('success', '<i class="fas fa-check-circle me-2"></i> ' + data.message);
                        
                        // Add success animation to row
                        if (bookingRow) {
                            bookingRow.style.transition = 'all 0.5s';
                            bookingRow.style.backgroundColor = '#d1fae5';
                            
                            // Fade out and remove row
                            setTimeout(() => {
                                bookingRow.style.opacity = '0';
                                
                                setTimeout(() => {
                                    bookingRow.style.display = 'none';
                                    
                                    // If no more bookings, show empty state
                                    const remainingBookings = document.querySelectorAll('tbody tr:not([style*="display: none"])');
                                    if (remainingBookings.length === 0) {
                                        // Fade out table
                                        const tableCard = document.querySelector('.card');
                                        if (tableCard) {
                                            tableCard.style.transition = 'all 0.5s';
                                            tableCard.style.opacity = '0';
                                            
                                            setTimeout(() => {
                                                location.reload(); // Reload to show empty state
                                            }, 500);
                                        } else {
                                            location.reload();
                                        }
                                    }
                                }, 500);
                            }, 1000);
                        }
                    } else {
                        // Show error alert
                        showAlert('danger', '<i class="fas fa-exclamation-circle me-2"></i> ' + data.message);
                        
                        // Reset row state
                        if (bookingRow) {
                            bookingRow.classList.remove('table-active');
                        }
                    }
                })
                .catch(error => {
                    // Hide modal
                    bootstrap.Modal.getInstance(document.getElementById('confirmModal')).hide();
                    
                    console.error('Error:', error);
                    showAlert('danger', '<i class="fas fa-exclamation-circle me-2"></i> Terjadi kesalahan saat memproses permintaan');
                    
                    // Reset row state
                    if (bookingRow) {
                        bookingRow.classList.remove('table-active');
                    }
                })
                .finally(() => {
                    // Reset button state
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;
                });
            }
              function rejectPayment(bookingId) {
                // Set booking details in modal
                const bookingRow = document.getElementById('booking-' + bookingId);
                if (bookingRow) {
                    // Get customer name
                    const customerName = bookingRow.querySelector('td:nth-child(2) div.fw-semibold').innerText;
                    document.getElementById('rejectTitle').innerText = 'Tolak Pembayaran: ' + customerName;
                    document.getElementById('rejectCustomerName').innerText = customerName;
                    
                    // Set booking ID
                    document.getElementById('rejectBookingId').innerText = '#' + bookingId;
                    
                    // Reset any previous notes
                    document.getElementById('rejectNotes').value = '';
                }
                
                // Show the modal with animation
                const modalElement = document.getElementById('rejectModal');
                modalElement.classList.add('fade');
                
                const modal = new bootstrap.Modal(modalElement);
                modal.show();
                
                // Update form action
                document.getElementById('rejectForm').action = `/employee/payments/reject/${bookingId}`;
                
                // Add submit handler with animation and feedback
                document.getElementById('rejectForm').onsubmit = function(e) {
                    const submitBtn = this.querySelector('button[type="submit"]');
                    const originalText = submitBtn.innerHTML;
                    
                    // Show loading state
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> Memproses...';
                    
                    // Add visual feedback (optional - form will submit and page will reload)
                    if (bookingRow) {
                        bookingRow.classList.add('table-danger');
                        bookingRow.style.transition = 'all 0.3s ease';
                    }
                    
                    // Normal form submission continues
                    setTimeout(() => {
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = originalText;
                    }, 10000); // Safety timeout in case form hangs
                };
            }
              function showAlert(type, message) {
                // Create custom toast-like alert with enhanced styling
                const toastContainer = document.createElement('div');
                toastContainer.className = 'position-fixed top-0 end-0 p-4';
                toastContainer.style.zIndex = '9999';
                
                // Map alert types to icons and styles
                const alertConfig = {
                    'success': {
                        icon: 'fas fa-check-circle',
                        gradient: 'linear-gradient(45deg, #10b981, #059669)'
                    },
                    'danger': {
                        icon: 'fas fa-exclamation-circle',
                        gradient: 'linear-gradient(45deg, #ef4444, #dc2626)'
                    },
                    'warning': {
                        icon: 'fas fa-exclamation-triangle',
                        gradient: 'linear-gradient(45deg, #f59e0b, #d97706)'
                    },
                    'info': {
                        icon: 'fas fa-info-circle',
                        gradient: 'linear-gradient(45deg, #3b82f6, #2563eb)'
                    }
                };
                
                const config = alertConfig[type] || alertConfig.info;
                
                const toast = document.createElement('div');
                toast.className = `toast border-0 shadow-lg`;
                toast.setAttribute('role', 'alert');
                toast.setAttribute('aria-live', 'assertive');
                toast.setAttribute('aria-atomic', 'true');
                
                // Applying custom styles
                toast.style.background = config.gradient;
                toast.style.color = 'white';
                toast.style.borderRadius = '12px';
                toast.style.overflow = 'hidden';
                toast.style.transform = 'translateY(20px)';
                toast.style.opacity = '0';
                toast.style.transition = 'all 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55)';
                toast.style.boxShadow = '0 12px 28px rgba(0, 0, 0, 0.2)';
                
                toast.innerHTML = `
                    <div class="d-flex align-items-center p-3">
                        <div class="me-3">
                            <i class="${config.icon} fa-lg"></i>
                        </div>
                        <div class="toast-body px-0 py-1 flex-grow-1">
                            ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                `;
                
                toastContainer.appendChild(toast);
                document.body.appendChild(toastContainer);
                
                // Initialize and show toast
                const bsToast = new bootstrap.Toast(toast, {
                    animation: false, // We'll handle our own animation
                    autohide: true,
                    delay: 5000
                });
                
                bsToast.show();
                
                // Apply entrance animation
                setTimeout(() => {
                    toast.style.transform = 'translateY(0)';
                    toast.style.opacity = '1';
                }, 50);
                
                // Add exit animation before hidden
                toast.addEventListener('hide.bs.toast', () => {
                    toast.style.transform = 'translateY(-20px)';
                    toast.style.opacity = '0';
                });
                
                // Remove from DOM when hidden
                toast.addEventListener('hidden.bs.toast', () => {
                    toastContainer.remove();
                });
                
                // Add hover effect
                toast.addEventListener('mouseenter', () => {
                    toast.style.transform = 'translateY(-3px) scale(1.02)';
                    toast.style.boxShadow = '0 14px 30px rgba(0, 0, 0, 0.25)';
                });
                
                toast.addEventListener('mouseleave', () => {
                    toast.style.transform = 'translateY(0) scale(1)';
                    toast.style.boxShadow = '0 12px 28px rgba(0, 0, 0, 0.2)';
                });
            }
            
            // Initialize popovers and tooltips
            document.addEventListener('DOMContentLoaded', function() {
                var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
                var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl);
                });
            });
        </script>
    </div>
</div>

<!-- Modal Reject Payment -->
        <div class="modal fade" id="rejectModal" tabindex="-1" aria-labelledby="rejectModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content border-0 shadow-lg" style="border-radius: 16px; overflow: hidden;">
                    <div class="modal-header" style="background: linear-gradient(45deg, #dc2626, #b91c1c); color: white; border: none; padding: 1.2rem 1.5rem;">
                        <h5 class="modal-title" id="rejectModalLabel"><i class="fas fa-times-circle me-2"></i> Tolak Pembayaran</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form id="rejectForm" method="POST">
                        <div class="modal-body p-0">
                            <div class="text-center p-4 border-bottom">
                                <div class="mb-4 reject-warning-icon">
                                    <div class="warning-animation" style="width: 80px; height: 80px; margin: 0 auto; position: relative;">
                                        <div style="width: 80px; height: 80px; background-color: #fef2f2; border-radius: 50%; display: flex; align-items: center; justify-content: center; animation: pulse-red 2s infinite;">
                                            <i class="fas fa-exclamation-triangle text-danger fa-2x" style="animation: bounce 0.6s ease-in-out 0.3s both;"></i>
                                        </div>
                                    </div>
                                </div>
                                <h4 class="fw-bold" id="rejectTitle">Tolak Pembayaran</h4>
                                <div class="booking-info p-3 mb-3 bg-light rounded-3 border mx-lg-4">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span class="text-muted">ID Booking:</span>
                                        <span class="fw-bold" id="rejectBookingId">-</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="text-muted">Customer:</span>
                                        <span class="fw-bold" id="rejectCustomerName">-</span>
                                    </div>
                                </div>
                                <div class="alert alert-warning py-2">
                                    <i class="fas fa-exclamation-circle me-2"></i>
                                    Perhatian! Pembayaran yang ditolak akan membatalkan booking dan tidak dapat dibatalkan.
                                </div>
                            </div>
                            <div class="p-4">
                                <div class="mb-3">
                                    <label for="rejectNotes" class="form-label d-flex align-items-center">
                                        <i class="fas fa-comment-alt me-2 text-danger"></i>
                                        Alasan Penolakan <span class="text-danger ms-1">*</span>
                                    </label>
                                    <textarea class="form-control" id="rejectNotes" name="notes" rows="3" required placeholder="Jelaskan alasan pembayaran ditolak..."></textarea>
                                    <div class="form-text">Alasan akan ditampilkan kepada customer</div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer bg-light border-0 py-3">
                            <button type="button" class="btn btn-outline-secondary rounded-pill px-4" data-bs-dismiss="modal">
                                <i class="fas fa-arrow-left me-2"></i> Batal
                            </button>
                            <button type="submit" class="btn btn-danger rounded-pill px-4 ms-2">
                                <i class="fas fa-times-circle me-2"></i> Tolak Pembayaran
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <style>
            @keyframes pulse-red {
                0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.4); }
                70% { box-shadow: 0 0 0 10px rgba(220, 38, 38, 0); }
                100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); }
            }
            
            @keyframes bounce {
                0% { transform: scale(0.5); opacity: 0; }
                50% { transform: scale(1.2); opacity: 0.8; }
                100% { transform: scale(1); opacity: 1; }
            }
        </style>
        
        <!-- Modal Confirm Payment -->
        <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content border-0 shadow-lg" style="border-radius: 16px; overflow: hidden;">
                    <div class="modal-header" style="background: linear-gradient(45deg, #10b981, #059669); color: white; border: none; padding: 1.2rem 1.5rem;">
                        <h5 class="modal-title" id="confirmModalLabel"><i class="fas fa-check-circle me-2"></i> Konfirmasi Pembayaran</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body p-0">
                        <div class="text-center p-4 border-bottom">
                            <div class="mb-4">
                                <div style="width: 80px; height: 80px; background-color: #d1fae5; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto;">
                                    <i class="fas fa-check-circle text-success fa-3x" style="animation: pulse-green 2s infinite;"></i>
                                </div>
                            </div>
                            <h4 class="fw-bold" id="confirmTitle">Konfirmasi Pembayaran</h4>
                            <div class="booking-info p-3 mb-3 bg-light rounded-3 border mx-lg-4">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span class="text-muted">ID Booking:</span>
                                    <span class="fw-bold" id="confirmBookingId">-</span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span class="text-muted">Total Bayar:</span>
                                    <span class="fw-bold text-success" id="confirmAmount">-</span>
                                </div>
                            </div>
                        </div>
                        <div class="p-4">
                            <div class="mb-3">
                                <label for="confirmNotes" class="form-label d-flex align-items-center">
                                    <i class="fas fa-comment-alt me-2 text-success"></i>
                                    Catatan (Opsional)
                                </label>
                                <textarea class="form-control" id="confirmNotes" name="notes" rows="2" placeholder="Tambahkan catatan jika diperlukan..."></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer bg-light border-0 py-3">
                        <button type="button" class="btn btn-outline-secondary rounded-pill px-4" data-bs-dismiss="modal">
                            <i class="fas fa-times me-2"></i> Batal
                        </button>
                        <button id="confirmSubmit" type="button" class="btn btn-success rounded-pill px-4 ms-2">
                            <i class="fas fa-check-circle me-2"></i> Konfirmasi Pembayaran
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <style>
            @keyframes pulse-green {
                0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
                70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
                100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
            }
        </style>
</div>
</body>
</html>
